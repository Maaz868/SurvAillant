
{% extends "header.html" %} 
{% block content %} 
  {% load static %}


 

  
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <link href="{% static 'sniffstyle.css' %}" rel="stylesheet">
  
  <script>
    var socket = new WebSocket("ws://" + window.location.host + "/ws/packet/");
    var rowCounter = 2; // Counter for auto-incrementing row numbers

    socket.onmessage = function (event) {
        var data = JSON.parse(event.data);
        // console.log(packet.ip_src);
        var packet = data.packet;
        // Create a new row in the table
        var newRow = $("<tr>");
        newRow.append("<th scope='row'><a href='#'>" + rowCounter + "</a></th>");
        newRow.append("<td>" + packet.ip_src + "</td>");
        newRow.append("<td>" + packet.ip_dst + "</td>");
        newRow.append("<td>" + packet.src_port + "</td>");
        newRow.append("<td>" + packet.dst_port + "</td>");
        newRow.append("<td>" + packet.src_mac + "</td>");
        newRow.append("<td>" + packet.dst_mac + "</td>");
        newRow.append("<td>" + packet.protocol + "</td>");
        newRow.append("<td>" + packet.timestamp + "</td>");
        newRow.append("<td>" + packet.window_size + "</td>");

        // Append the new row to the table body
        $("#dataTable tbody").append(newRow);
        rowCounter++;
    };

    function applyFilter() {
        var filterValue = $("#filter-input").val();
        socket.send(JSON.stringify({ filter: filterValue }));
    }
</script>
  <main id="main" class="main">


    <section class="section dashboard">
      <div class="row">

        <!-- Left side columns -->
        <div class="col-lg-14">
          <div class="card recent-sales overflow-auto">
                <div class="card-body">
                  <h5 class="card-title">SCADA Network Traffic</h5>

                  <table class="table table-borderless datatable" id="dataTable">
                    <thead>
                      <tr>
                        <th scope="col">#</th>
                        <th scope="col">Source IP</th>
                        <th scope="col">Destination IP</th>
                        <th scope="col">Source Port</th>
                        <th scope="col">Destination Port</th>
                        <th scope="col">Source MAC</th>
                        <th scope="col">Destination MAC</th>
                        <th scope="col">Protocol</th>
                        <th scope="col">Timespan</th>
                        <th scope="col">WindowSize</th>
                      </tr>
                    </thead>
                    <tbody id="table-body" >
                      <!-- Your table content goes here -->
                      <tr>
                        <th scope="row">1</th>
                        <td>35.213.232.93</td>
                        <td>10.7.224.212</td>
                        <td>443</td>
                        <td>34</td>
                        <td>28:a6:db:40:6f:9a</td>
                        <td>b8:9a:2a:74:62:0b</td>
                        <td>6</td>
                        <td>2024-03-11 13:51:18</td>
                        <td>64240
                        </td>
                      </tr>
                  </tbody>
                  
                  </table>

                </div>
              </div>

              </div>
            </div><!-- End Recent Sales -->

            

          </div>
        </div><!-- End Left side columns -->
    </section>

  </main><!-- End #main -->

 
  <script>
    $(document).ready(function () {
        // Initialize DataTable on the table
        $('#dataTable').DataTable({
            searching: true, // Disable search bar
            paging: true, // Disable pagination
            info: false, // Disable table information
        });
    });

    let filters = [];

    function populateTable(filteredData = data) {
        const tableBody = document.getElementById('table-body');
        tableBody.innerHTML = '';

        filteredData.forEach(rowData => {
            const row = document.createElement('tr');
            Object.values(rowData).forEach(value => {
                const cell = document.createElement('td');
                cell.textContent = value;
                row.appendChild(cell);
            });
            tableBody.appendChild(row);
        });
    }

    function applyFilter() {
        const filterBy = document.getElementById('filter').value;
        const filterValue = document.getElementById('filter-value').value.toLowerCase();

        const filterCondition = {
            key: filterBy,
            value: filterValue
        };
        filters = [filterCondition];

        const filteredData = filterData(data, filters);
        populateTable(filteredData);
    }

    function addFilter() {
        const filterGroup = document.createElement('div');
        filterGroup.classList.add('filter-group');

        const filterSelect = document.createElement('select');
        filterSelect.id = 'filter';
        filterSelect.innerHTML = document.getElementById('filter').innerHTML;

        const filterValueInput = document.createElement('input');
        filterValueInput.type = 'text';
        filterValueInput.id = 'filter-value';
        filterValueInput.placeholder = 'Enter value...';

        filterGroup.appendChild(filterSelect);
        filterGroup.appendChild(document.createTextNode('Where:'));
        filterGroup.appendChild(filterValueInput);

        document.getElementById('filter-section').appendChild(filterGroup);
    }

    function clearAllFilters() {
        document.getElementById('filter-value').value = '';
        filters = [];
        document.querySelectorAll('.filter-group').forEach(group => group.remove());
        applyFilter();
    }

    function filterData(data, filters) {
        return data.filter(row => {
            return filters.every(filter => {
                const cellValue = row[filter.key].toString().toLowerCase();
                return cellValue.includes(filter.value);
            });
        });
    }

    function toggleFilterSection() {
        const filterSection = document.getElementById('filter-section');
        filterSection.style.display = (filterSection.style.display === 'none') ? 'block' : 'none';
    }
</script>

  <!-- Template Main JS File -->
  <!-- <script src="{% static 'assets/js/main.js' %}"></script> -->
  


  {% endblock %}